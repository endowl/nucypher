# Finnigan's Wake Demo
## Ursula exchange example over live network

This illustrates Alice sharing data with Bob over the NuCypher network using proxy re-encryption,
without revealing private keys to intermediary entities.

1. Alice sets a Policy on the NuCypher network (2/3) and grants access to Bob
2. Label and Alice's public key provided to Bob
4. Bob joins the policy by Label and Alice's public key
5. Enrico created for the policy 
6. Each plaintext message gets encapsulated through the Enrico to messageKit
5. Bob receives and reconstructs the Enrico from Policy public key and Enrico public key
6. Bob retrieves the original message from Enrico and MessageKit


### Run a fleet of federated Ursulas
`python ../run_demo_ursula_fleet.py`


### Download the Book!
`./download_finnegans_wake.sh` 


### Run
`python finnegans-wake-demo.py`

# Alice's Wake Demo
This is an attempt to illustrate how to have a semi-trusted intermediary set up a re-encryption using the kfrags previously generated by Alice.

1. Alice generates kfrags for reencryption of an asset for Bob.
2. Alice communicates the kfrags and public key to Mitchel.
3. Time passes.
4. Alice dies. :`(
5. Mitchel sets up an agreement with random Ursulas using Alice's kfrags and public key.
6. Bob joins the policy, gets the asset reencrypted, decrypts.

## Environmental Variables
```shell script
PYTHONUNBUFFERED=1
NUCYPHER_PROVIDER_URI=https://goerli.infura.io/v3/b70fd2516d87475b9974ece2234dd085
ALICE_SIGNER_URI=keystore:///Users/ken/.keystore/UTC--2021-02-10T01-35-19.992885000Z--22003c7d9fc169d92d695872a04caca6a064f0a8
ALICE_ETH_ADDRESS=0x22003c7d9fc169D92D695872A04CACa6a064F0a8
MITCHEL_SIGNER_URI=keystore:///Users/ken/.keystore/UTC--2021-02-10T01-37-01.441683000Z--502c8f0d22a4495b17bfba9dc9b7a9623db693a2
MITCHEL_ETH_ADDRESS=0x502C8f0D22a4495b17Bfba9dC9b7A9623DB693A2
```

## Changed functions
File: lawful

function: create_policy()
- accept kfrags and a public_key instead of generating them
- There is experimental code to allow an alice to be passed in that is not currently being executed.

## Issues
Failing on step 5 during policy enactment. Here's the log:

```text
Proposing arrangement Arrangement(client_key=UmbralPublicKey:03c635a58d0717e) to (Ursula)⇀DarkCyan Charlie WhiteSmoke November↽ (0xecB5105846Fd77416550460c71f7fab9f1cfbeba)
Arrangement accepted by (Ursula)⇀LimeGreen Five Linen Eight↽ (0x542D4b7f72Cddf9cF020602CA1c9d58482ec3254)
Arrangement accepted by (Ursula)⇀Plum Two Olive Quebec↽ (0xd46db4b93271CC73CA4D920ba017982d42E263BA)
Arrangement accepted by (Ursula)⇀DarkCyan Charlie WhiteSmoke November↽ (0xecB5105846Fd77416550460c71f7fab9f1cfbeba)
Finished proposing arrangements; accepted: 0x542D4b7f72Cddf9cF020602CA1c9d58482ec3254, 0xd46db4b93271CC73CA4D920ba017982d42E263BA, 0xecB5105846Fd77416550460c71f7fab9f1cfbeba
[TX-CREATEPOLICY] | value: 900 gwei, chainId: 5, nonce: 10, from: 0x502C8f0D22a4495b17Bfba9dC9b7A9623DB693A2, selector: 0x81e742a1
Broadcasting CREATEPOLICY Transaction (0.060030165 ETH @ 249 gwei)...
Broadcasting CREATEPOLICY Transaction (0.060030165 ETH @ 249 gwei)...
[RECEIPT-CREATEPOLICY] | txhash: 0xab15bc7f126f7affdced82633679d755fb5bd599d0bae006fccee57d27df7abf
Policy enactment failed. Request statuses:
0x542D4b7f72Cddf9cF020602CA1c9d58482ec3254: 500
0xd46db4b93271CC73CA4D920ba017982d42E263BA: 500
0xecB5105846Fd77416550460c71f7fab9f1cfbeba: 500
```

An example of the Arrangement tx can be viewed at https://goerli.etherscan.io/tx/0xab15bc7f126f7affdced82633679d755fb5bd599d0bae006fccee57d27df7abf.

Also, if grantor is changed to ALICE on line #198 and lines 172-194 are commented, the code works as expected.